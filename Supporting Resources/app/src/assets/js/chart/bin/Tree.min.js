/*! Vizuly2 07-06-2019 */

var t, e;
t = this, e = function(e) {
    "use strict";
    var vizuly5 = {
        version: "2.2.78",
        loadD3: function(t) {
            vizuly5.d5 = t
        }
    };
    void 0 !== window.d3v4 ? vizuly5.d5 = window.d3v4 : "undefined" != typeof d5 ? vizuly5.d5 = d5 : void 0 !== window.d5 && (vizuly5.d5 = window.d5), vizuly5.d5 ? Number(vizuly5.d5.version.substr(0, 1)) < 4 && console.log("WARNING - Your D3 Library v" + vizuly5.d5.version + " is not compatible with this version of Vizuly.   Please use D3 v4.0.0 or higher.") : console.log("WARNING - No D3 library found for vizuly5!  Please load D3 library before instantiating a component."), vizuly5.core = {}, vizuly5.viz = {}, vizuly5.viz.layout = {}, vizuly5.viz.layout.CLUSTERED = "CLUSTERED", vizuly5.viz.layout.STACKED = "STACKED", vizuly5.viz.layout.OVERLAP = "OVERLAP", vizuly5.viz.layout.STREAM = "STREAM", vizuly5.svg = {}, vizuly5.ui = {}, vizuly5.assets = {}, vizuly5.core.component = function(t, f) {
        var n, r, d5 = vizuly5.d5,
            a = 50;
        "string" == typeof t && (t = d5.select(t).node()), f.parent = t, f.id = vizuly5.util.guid(), f.selection = d5.select(t).append("div").attr("id", "div_" + f.id).style("width", "100%").style("height", "100%"), f.initialized = !1, f.size = null, f.styles;
        var i = {},
            o = ["dataTipRenderer"],
            l = ["initialized", "validated", "measured", "updated", "styled"];

        function c() {
            null == n && (r = r || f.selection.node().getBoundingClientRect(), n = setTimeout(function() {
                var t = f.selection.node().getBoundingClientRect();
                if (p.update && (t.width != r.width || t.height != r.height)) {
                    if (p.duration) {
                        var e = p.duration();
                        p.duration(0).update().duration(e)
                    } else p.update();
                    f.dispatch
                }
                r = t, n = null
            }, a))
        }
        Object.getOwnPropertyNames(f.properties).forEach(function(t, e, n) {
            l.push(t + "_change")
        }), f.events && 0 < f.events.length && f.events.forEach(function(t) {
            l.push(t)
        }), f.dispatch = d5.dispatch.apply(this, l);
        var p = function() {
            var r, a, i;
            return r = p, i = (a = f).properties, Object.getOwnPropertyNames(i).forEach(function(n, t, e) {
                void 0 === a[n] && (a[n] = i[n], r[n] = function(t) {
                    if (!arguments.length) return a[n];
                    var e = a[n];
                    return a[n] = t, a[n] !== e && a.dispatch.apply(n + "_change", this, [a[n], e]), r
                })
            }), p
        };
        return f.dispatch.component = p(), p.id = function() {
            return f.id
        }, p.selection = function() {
            return f.selection
        }, p.style = function(t, e) {
            return arguments.length < 2 ? i[t] ? i[t] : f.styles[t] ? f.styles[t] : null : (i[t] = e, p)
        }, p.applyStyles = function(e) {
            return Object.keys(f.styles).forEach(function(t) {
                p.style(t, e[t])
            }), p
        }, p.clearStyles = function() {
            return Object.keys(f.styles).forEach(function(t) {
                p.style(t, null)
            }), p
        }, p.getStyle = function(t, e) {
            return null != i[t] ? "function" == typeof i[t] ? i[t].apply(p, e) : i[t] : null != f.styles[t] ? "function" == typeof f.styles[t] ? f.styles[t].apply(p, e) : f.styles[t] : null
        }, p.on = function(t, e) {
            return f.dispatch.on(t, e), p
        }, p.onChange = function(t, e) {
            var n = t.split("."),
                r = n[0] + "_change" + (1 < n.length ? "." + n[1] : "");
            return f.dispatch.on(r, e), p
        }, p.validate = function() {
            if (0 == f.initialized && f.initialize && (f.initialize(), f.initialized = !0), !e) {
                var e = [];
                if (Object.getOwnPropertyNames(f.properties).forEach(function(t) {
                        !f[t] && Number(0 != f[t]) && o.indexOf(t) < 0 && e.push(t)
                    }), 0 < e.length) throw new Error("vizuly5.util.component.validate(): " + e.concat() + " need to be declared");
                f.dispatch.apply("validated", this)
            }
        }, p.applyCallbacks = function(t) {
            t.forEach(function(t) {
                f.dispatch.on(t.on, t.callback)
            })
        }, p.showDataTip = function(t, e, n, r) {
            if (f.dataTipRenderer && null != f.dataTipRenderer) {
                var a, i, o = t.getBoundingClientRect(),
                    l = d5.select("body").append("div").attr("class", "vz-data-tip").style("display", "none"),
                    c = o.left,
                    u = o.top + window.pageYOffset,
                    d = f.dataTipRenderer.apply(p, [l, t, e, n, r, c, u]);
                if (0 != d) {
                    d && "object" == typeof d && d.constructor === Array && (c = d[0], u = d[1]);
                    var s = l.nodes()[0].getBoundingClientRect();
                    a = s.width, i = s.height, l.style("left", c ? c + "px" : o.left + o.width / 2 - a / 2 + "px").style("top", u ? u + "px" : o.top + window.pageYOffset - i - 10 + "px"), l.style("display", "block")
                    l.style("display", "block"),
                    l.style("position","absolute"),
                    l.style("border-radius", "4px"),
                    l.style("border",'1px solid black'),
                    l.style("padding", "5px"),
                  //  o.style("width", "175px"),
                    l.style("background", "rgba(0,0,0,.8)"),
                    l.style("box-shadow", "0px 2px 3px 2px rgba(0, 0, 0, .25)"),
                    l.style("pointer-events", "none");
                }
            }
        }, p.removeDataTip = function() {
            d5.select(".vz-data-tip").remove()
        }, p.parent = function() {
            return f.parent
        }, p.size = function() {
            return f.size
        }, p.updateOnResize = function(t, e) {
            return !0 === t ? (d5.select(window).on("resize.component_" + f.id, c), e && (a = e)) : (d5.select(window).on("resize.component_" + f.id, null), a = 50), p
        }, p.destroy = function() {
            f.selection.remove(), f.selection = null, l.forEach(function(t) {
                f.dispatch.on(t, null)
            }), f.dispatch = null, f = null
        }, f.dispatch.component
    }, vizuly5.util = {}, vizuly5.util.getRelativeWidth = function(t, e) {
        if ("string" != typeof t || "%" != t.substr(t.length - 1)) return Number(t);
        var n = Math.min(Number(t.substr(0, t.length - 1)), 100) / 100;
        return Math.round(e.getBoundingClientRect().width * n)
    }, vizuly5.util.getRelativeHeight = function(t, e) {
        if ("string" != typeof t || "%" != t.substr(t.length - 1)) return Number(t);
        var n = Math.min(Number(t.substr(0, t.length - 1)), 100) / 100;
        return Math.round(e.getBoundingClientRect().height * n)
    }, vizuly5.util.size = function(t, e, n, r) {
        var a = {};
        return r && (e = vizuly5.util.getRelativeWidth(e, r), n = vizuly5.util.getRelativeHeight(n, r)), a.measuredWidth = e, a.measuredHeight = n, a.width = e - vizuly5.util.measure(t.left, e) - vizuly5.util.measure(t.right, e), a.height = n - vizuly5.util.measure(t.top, n) - vizuly5.util.measure(t.bottom, n), a.top = vizuly5.util.measure(t.top, n), a.left = vizuly5.util.measure(t.left, e), a.bottom = vizuly5.util.measure(t.bottom, n), a.right = vizuly5.util.measure(t.right, e), a
    }, vizuly5.util.getTypedScale = function(t) {
        return "string" == typeof t ? vizuly5.d5.scaleBand() : t instanceof Date ? vizuly5.d5.scaleTime() : vizuly5.d5.scaleLinear()
    }, vizuly5.util.measure = function(t, e) {
        if ("string" != typeof t || "%" != t.substr(t.length - 1)) return Number(t);
        var n = Math.min(Number(t.substr(0, t.length - 1)), 100) / 100;
        return Math.round(e * n)
    }, vizuly5.util.guid = function() {
        return "vzxxxxxxxx".replace(/[xy]/g, function(t) {
            var e = 16 * Math.random() | 0;
            return ("x" === t ? e : 3 & e | 8).toString(16)
        })
    }, vizuly5.util.getDefs = function(t) {
        var e = t.selection().selectAll("svg defs");
        return e.nodes() && e.nodes().length < 1 && (e = t.selection().select("svg").append("defs")), e
    }, vizuly5.util.createCSSKey = function(t) {
        return "css" + vizuly5.util.cleanString(t)
    }, vizuly5.util.cleanString = function(t) {
        var e = String(t).replace(",", "_");
        return (e = e.replace(/[\s+,'+,\.,\(,\),\',\&,\/]/g, "")).toUpperCase()
    }, vizuly5.util.aggregateNest = function(t, c, u) {
        for (var e = t[0]; e.values;) e = e.values[0];
        var a = [];

        function d(t, e) {
            if (e)
                for (var n = 0; n < a.length; n++) {
                    var r = a[n];
                    null != t[r] && (t["childProp_" + r] = t[r]), e["childProp_" + r] = t["childProp_" + r] ? t["childProp_" + r] : t[r]
                }
        }
        Object.getOwnPropertyNames(e).forEach(function(t) {
                a.push(t)
            }),
            function t(e, n) {
                for (var r = 0; r < e.length; r++) {
                    var a = e[r];
                    if (a.values) {
                        t(a.values, a);
                        for (var i = 0; i < a.values.length; i++)
                            for (var o = a.values[i], l = 0; l < c.length; l++) isNaN(a["agg_" + c[l]]) && (a["agg_" + c[l]] = 0), a["agg_" + c[l]] = u(a["agg_" + c[l]], o["agg_" + c[l]])
                    } else
                        for (l = 0; l < c.length; l++) a["agg_" + c[l]] = Number(a[c[l]]), isNaN(a["agg_" + c[l]]) && (a["agg_" + c[l]] = 0);
                    d(a, n)
                }
            }(t)
    }, vizuly5.util.format_YEAR_Mon_MonDay = function(t) {
        var e = vizuly5.d5.timeFormat(".%L"),
            n = vizuly5.d5.timeFormat(":%S"),
            r = vizuly5.d5.timeFormat("%I:%M"),
            a = vizuly5.d5.timeFormat("%I %p"),
            i = vizuly5.d5.timeFormat("%a %d"),
            o = vizuly5.d5.timeFormat("%b %d"),
            l = vizuly5.d5.timeFormat("%b"),
            c = vizuly5.d5.timeFormat("%Y");
        return (vizuly5.d5.timeSecond(t) < t ? e : vizuly5.d5.timeMinute(t) < t ? n : vizuly5.d5.timeHour(t) < t ? r : vizuly5.d5.timeDay(t) < t ? a : vizuly5.d5.timeMonth(t) < t ? vizuly5.d5.timeWeek(t) < t ? i : o : vizuly5.d5.timeYear(t) < t ? l : c)(t)
    }, vizuly5.util.stackOffsetBaseline = function(t, e) {
        if (1 < (n = t.length)) {
            var n, r = 1,
                a = t[e[0]];
            for (a.length; r < n; ++r) a = t[e[r]]
        }
    }, vizuly5.util.rgbToHex = function(t) {
        var e = String(t).match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);
        return e && 4 === e.length ? "#" + ("0" + parseInt(e[1], 10).toString(16)).slice(-2) + ("0" + parseInt(e[2], 10).toString(16)).slice(-2) + ("0" + parseInt(e[3], 10).toString(16)).slice(-2) : ""
    }, vizuly5.util.transitionOnEnd = function(t, e) {
        var n = 0;
        t.on("start", function() {
            n++
        }).on("end", function() {
            0 == --n && e()
        })
    }, vizuly5.util.colorBrightness = function(t) {
        return (299 * t.r + 587 * t.g + 114 * t.b) / 1e3
    }, vizuly5.util.scaleRadial = function() {
        var e = vizuly5.d5.scaleLinear();

        function n(t) {
            return Math.sqrt(e(t))
        }
        return n.domain = function(t) {
            return arguments.length ? (e.domain(t), n) : e.domain()
        }, n.nice = function(t) {
            return e.nice(t), n
        }, n.range = function(t) {
            return arguments.length ? (e.range(t.map(function(t) {
                return t * t
            })), n) : e.range().map(Math.sqrt)
        }, n.ticks = e.ticks, n.tickFormat = e.tickFormat, n
    }, vizuly5.svg.filter = {}, vizuly5.svg.filter.dropShadow = function(t, e, n, r) {
        var a = Math.round(100 * e) + "_" + Math.round(100 * n) + "_" + Math.round(100 * r),
            i = t.id(),
            o = vizuly5.util.getDefs(t).selectAll("#vz_filter_" + i + "_" + a).data([a]).enter().append("filter").attr("id", "vz_filter_" + i + "_" + a).attr("class", "vz-svg-filter-dropShadow").attr("width", "300%").attr("height", "300%");
        o.append("feGaussianBlur").attr("in", "SourceAlpha").attr("stdDeviation", r), o.append("feOffset").attr("dx", e).attr("dy", n), o.append("feComponentTransfer").append("feFuncA").attr("type", "linear").attr("slope", .2);
        var l = o.append("feMerge");
        return l.append("feMergeNode"), l.append("feMergeNode").attr("in", "SourceGraphic"), "#vz_filter_" + i + "_" + a
    }, vizuly5.svg.gradient = {}, vizuly5.svg.gradient.blend = function(t, e, n, r) {
        var a, i, o, l, c = String(e).replace("#", "") + String(n).replace("#", ""),
            u = "vz_gradient_blend_" + t.id() + "_" + c;
        l = "horizontal" == r ? (a = "100%", o = i = "0%") : (o = "100%", i = a = "0%");
        var d = vizuly5.util.getDefs(t),
            s = d.selectAll("#" + u).data([c]);
        return (s = s.enter().append("linearGradient").attr("id", u).attr("class", "vz-svg-gradient-blend").attr("x1", a).attr("x2", i).attr("y1", o).attr("y2", l)).append("stop").attr("offset", "0%").attr("stop-color", e), s.append("stop").attr("offset", "100%").attr("stop-color", n), d.selectAll("#" + u)
    }, vizuly5.svg.gradient.blendMultiple = function(t, e, n, r) {
        var a = "";
        e.forEach(function(t) {
            a += String(t).replace("#", "") + "_"
        });
        var i, o, l, c, u = "vz_gradient_blend_" + t.id() + "_" + a;
        c = "horizontal" == r.toLowerCase() ? (i = "100%", l = o = "0%") : (l = "100%", o = i = "0%");
        var d = vizuly5.util.getDefs(t),
            s = d.selectAll("#" + u).data([a]);
        return s = s.enter().append("linearGradient").attr("id", u).attr("class", "vz-svg-gradient-blend").attr("x1", i).attr("x2", o).attr("y1", l).attr("y2", c), e.forEach(function(t, e) {
            s.append("stop").attr("offset", 100 * n[e] + "%").attr("stop-color", t)
        }), s = d.selectAll("#" + u)
    }, vizuly5.svg.gradient.radialBlend = function(t, e, n, r, a, i, o, l, c) {
        var u = String(r).replace("#", "") + String(a).replace("#", "") + String(i).replace("%", "") + String(o).replace("%", ""),
            d = "vz_gradient_radial_blend_" + t.id() + "_" + u,
            s = vizuly5.util.getDefs(t),
            f = s.selectAll("#" + d).data([u]);
        return (f = f.enter().append("radialGradient").attr("id", d).attr("class", "vz-svg-gradient-radial-blend").attr("cx", e).attr("cy", n)).append("stop").attr("offset", i).attr("stop-color", r).attr("stop-opacity", void 0 === l ? 1 : l), f.append("stop").attr("offset", o).attr("stop-color", a).attr("stop-opacity", void 0 === c ? 1 : c), s.selectAll("#" + d)
    }, vizuly5.svg.gradient.fade = function(t, e, n, r, a) {
        a || (a = [0, 1]), r || (r = [.75, .9]);
        var i, o, l, c, u = String(e).replace("#", ""),
            d = "vz_gradient_fade_" + t.id() + "_" + u;
        c = "horizontal" == n.toLowerCase() ? (o = "100%", l = i = "0%") : (l = "100%", o = i = "0%");
        var s = vizuly5.util.getDefs(t),
            f = s.selectAll("#" + d).data([u]).enter().append("linearGradient").attr("id", d).attr("class", "vz-svg-gradient-fade").attr("x1", i).attr("x2", o).attr("y1", l).attr("y2", c);
        return f.append("stop").attr("offset", 100 * a[0] + "%").attr("stop-color", e).attr("stop-opacity", r[0]), f.append("stop").attr("offset", 100 * a[1] + "%").attr("stop-color", e).attr("stop-opacity", r[1]), s.selectAll("#" + d)
    }, vizuly5.svg.gradient.radialFade = function(t, e, n, r) {
        r || (r = [0, 1]), n || (n = [.75, .9]);
        var a = String(e).replace("#", ""),
            i = "vz_gradient_radial_fade" + t.id() + "_" + a,
            o = vizuly5.util.getDefs(t),
            l = o.selectAll("#" + i).data([a]).enter().append("radialGradient").attr("id", i).attr("class", "vz-svg-gradient-radial-fade");
        return l.append("stop").attr("offset", 100 * r[0] + "%").attr("stop-color", e).attr("stop-opacity", n[0]), l.append("stop").attr("offset", 100 * r[1] + "%").attr("stop-color", e).attr("stop-opacity", n[1]), o.selectAll("#" + i)
    }, vizuly5.svg.gradient.darker = function(t, e, n) {
        var r, a, i, o, l = String(e).replace("#", ""),
            c = "vz_gradient_darker_" + t.id() + "_" + l;
        o = "horizontal" == n.toLowerCase() ? (r = "100%", i = a = "0%") : (i = "100%", a = r = "0%");
        var u = vizuly5.util.getDefs(t),
            d = u.selectAll("#" + c).data([l]).enter().append("linearGradient").attr("class", "vz-gradient-darker").attr("id", c).attr("x1", r).attr("x2", a).attr("y1", i).attr("y2", o);
        return d.append("stop").attr("offset", "0%").attr("stop-color", e).attr("stop-opacity", .75), d.append("stop").attr("offset", "100%").attr("stop-color", vizuly5.d5.rgb(e).darker()).attr("stop-opacity", .9), u.selectAll("#" + c)
    }, vizuly5.svg.text = {}, vizuly5.svg.text.textArcPath = function(t, e) {
        var n = {};
        n.angle = e, n.startAngle = n.angle - 179 * .0174533, n.endAngle = n.angle + 179 * .0174533;
        var r = d5.arc().innerRadius(t).outerRadius(t)(n),
            a = /[Mm][\d\.\-e,\s]+[Aa][\d\.\-e,\s]+/.exec(r);
        return a && (a = a[0]), a
    }, vizuly5.svg.text.wrap = function(t, u, d, s) {
        var f = t.attr("x"),
            e = t.attr("y");
        f = !f || isNaN(f) ? 0 : f, e = !e || isNaN(e) ? 0 : e;
        var p = s / 3;
        t.each(function() {
            var t, e = d5.select(this),
                n = u.split(/\s+/).reverse(),
                r = [],
                a = 0,
                i = s,
                o = e.attr("y"),
                l = 1.1 * parseFloat(s / 2) + p;
            isNaN(l) && (l = 0);
            for (var c = e.text(null).append("tspan").attr("x", f).attr("y", o).attr("y", l).style("font-size", s + "px"); t = n.pop();) r.push(t), c.text(r.join(" ")), c.node().getComputedTextLength() > d && (r.pop(), c.text(r.join(" ")), r = [t], c = e.append("tspan").attr("x", f).attr("y", ++a * i + l + o).text(t).style("font-size", s + "px"))
        })
    };
    var a = {};

    function i(e, n, r) {
        return function() {
            var t = r.apply(n, arguments);
            return t === n ? e : t
        }
    }

    function f(t, e) {
        for (var n = [t], r = []; null != (t = n.pop());)
            if (r.push(t), (i = t.children) && (a = i.length))
                for (var a, i, o = -1; ++o < a;) n.push(i[o]);
        for (; null != (t = r.pop());) e(t)
    }

    function t(t) {
        return t.children
    }

    function n(t) {
        return t.value
    }

    function r(t, e) {
        return e.value - t.value
    }

    function o(t) {
        return a.merge(t.map(function(e) {
            return (e.children || []).map(function(t) {
                return {
                    source: e,
                    target: t
                }
            })
        }))
    }

    function l(t, e) {
        return t.value - e.value
    }

    function _(t, e) {
        var n = t._pack_next;
        (t._pack_next = e)._pack_prev = t, (e._pack_next = n)._pack_prev = e
    }

    function z(t, e) {
        (t._pack_next = e)._pack_prev = t
    }

    function b(t, e) {
        var n = e.x - t.x,
            r = e.y - t.y,
            a = t.r + e.r;
        return n * n + r * r < .999 * a * a
    }

    function p(t) {
        if ((e = t.children) && (c = e.length)) {
            var e, n, r, a, i, o, l, c, u = 1 / 0,
                d = -1 / 0,
                s = 1 / 0,
                f = -1 / 0;
            if (e.forEach(k), (n = e[0]).x = -n.r, n.y = 0, x(n), 1 < c && ((r = e[1]).x = r.r, r.y = 0, x(r), 2 < c))
                for (A(n, r, a = e[2]), x(a), _(n, a), _(n._pack_prev = a, r), r = n._pack_next, i = 3; i < c; i++) {
                    A(n, r, a = e[i]);
                    var p = 0,
                        h = 1,
                        g = 1;
                    for (o = r._pack_next; o !== r; o = o._pack_next, h++)
                        if (b(o, a)) {
                            p = 1;
                            break
                        }
                    if (1 == p)
                        for (l = n._pack_prev; l !== o._pack_prev && !b(l, a); l = l._pack_prev, g++);
                    p ? (h < g || h == g && r.r < n.r ? z(n, r = o) : z(n = l, r), i--) : (_(n, a), x(r = a))
                }
            var v = (u + d) / 2,
                y = (s + f) / 2,
                m = 0;
            for (i = 0; i < c; i++)(a = e[i]).x -= v, a.y -= y, m = Math.max(m, a.r + Math.sqrt(a.x * a.x + a.y * a.y));
            t.r = m, e.forEach(w)
        }

        function x(t) {
            u = Math.min(t.x - t.r, u), d = Math.max(t.x + t.r, d), s = Math.min(t.y - t.r, s), f = Math.max(t.y + t.r, f)
        }
    }

    function k(t) {
        t._pack_next = t._pack_prev = t
    }

    function w(t) {
        delete t._pack_next, delete t._pack_prev
    }

    function A(t, e, n) {
        var r = t.r + n.r,
            a = e.x - t.x,
            i = e.y - t.y;
        if (r && (a || i)) {
            var o = e.r + n.r,
                l = a * a + i * i,
                c = .5 + ((r *= r) - (o *= o)) / (2 * l),
                u = Math.sqrt(Math.max(0, 2 * o * (r + l) - (r -= l) * r - o * o)) / (2 * l);
            n.x = t.x + c * a + u * i, n.y = t.y + c * i - u * a
        } else n.x = t.x + r, n.y = t.y
    }
    a.layout = {}, a.svg = {}, a.functor = function(t) {
        return "function" == typeof t ? t : function() {
            return t
        }
    }, a.merge = function(t) {
        for (var e, n, r, a = t.length, i = -1, o = 0; ++i < a;) o += t[i].length;
        for (n = new Array(o); 0 <= --a;)
            for (e = (r = t[a]).length; 0 <= --e;) n[--o] = r[e];
        return n
    }, a.rebind = function(t, e) {
        for (var n, r = 1, a = arguments.length; ++r < a;) t[n = arguments[r]] = i(t, e, e[n]);
        return t
    }, a.layout.hierarchy = function() {
        var l = r,
            c = t,
            u = n;

        function d(t) {
            var e, n = [t],
                r = [];
            for (t.depth = 0; null != (e = n.pop());)
                if (r.push(e), (i = c.call(d, e, e.depth)) && (a = i.length)) {
                    for (var a, i, o; 0 <= --a;) n.push(o = i[a]), o.parent = e, o.depth = e.depth + 1;
                    u && (e.value = 0), e.children = i
                } else u && (e.value = +u.call(d, e, e.depth) || 0), delete e.children;
            return f(t, function(t) {
                var e, n;
                l && (e = t.children) && e.sort(l), u && (n = t.parent) && (n.value += t.value)
            }), r
        }
        return d.sort = function(t) {
            return arguments.length ? (l = t, d) : l
        }, d.children = function(t) {
            return arguments.length ? (c = t, d) : c
        }, d.value = function(t) {
            return arguments.length ? (u = t, d) : u
        }, d.revalue = function(t) {
            return u && (function(t, e) {
                for (var n, r = [t]; null != (t = r.pop());)
                    if ((n = t).children && (n.value = 0), (i = t.children) && (a = i.length))
                        for (var a, i; 0 <= --a;) r.push(i[a])
            }(t), f(t, function(t) {
                var e;
                t.children || (t.value = +u.call(d, t, t.depth) || 0), (e = t.parent) && (e.value += t.value)
            })), t
        }, d
    }, a.layout.pack = function() {
        var c, t, e, u = a.layout.hierarchy().sort(l),
            d = 0,
            s = [1, 1];

        function n(t, e) {
            var n = u.call(this, t, e),
                r = n[0],
                a = s[0],
                i = s[1],
                o = null == c ? Math.sqrt : "function" == typeof c ? c : function() {
                    return c
                };
            if (r.x = r.y = 0, f(r, function(t) {
                    t.r = +o(t.value)
                }), f(r, p), d) {
                var l = d * (c ? 1 : Math.max(2 * r.r / a, 2 * r.r / i)) / 2;
                f(r, function(t) {
                    t.r += l
                }), f(r, p), f(r, function(t) {
                    t.r -= l
                })
            }
            return function t(e, n, r, a) {
                var i = e.children;
                if (e.x = n += a * e.x, e.y = r += a * e.y, e.r *= a, i)
                    for (var o = -1, l = i.length; ++o < l;) t(i[o], n, r, a)
            }(r, a / 2, i / 2, c ? 1 : 1 / Math.max(2 * r.r / a, 2 * r.r / i)), n
        }
        return n.size = function(t) {
            return arguments.length ? (s = t, n) : s
        }, n.radius = function(t) {
            return arguments.length ? (c = null == t || "function" == typeof t ? t : +t, n) : c
        }, n.padding = function(t) {
            return arguments.length ? (d = +t, n) : d
        }, t = n, e = u, a.rebind(t, e, "sort", "children", "value"), (t.nodes = t).links = o, t
    }, a.svg.diagonal = function() {
        var o = function(t) {
                return t.source
            },
            l = function(t) {
                return t.target
            },
            c = function(t) {
                return [t.x, t.y]
            };

        function e(t, e) {
            var n = o.call(this, t, e),
                r = l.call(this, t, e),
                a = (n.y + r.y) / 2,
                i = [n, {
                    x: n.x,
                    y: a
                }, {
                    x: r.x,
                    y: a
                }, r];
            return "M" + (i = i.map(c))[0] + "C" + i[1] + " " + i[2] + " " + i[3]
        }
        return e.source = function(t) {
            return arguments.length ? (o = a.functor(t), e) : o
        }, e.target = function(t) {
            return arguments.length ? (l = a.functor(t), e) : l
        }, e.projection = function(t) {
            return arguments.length ? (c = t, e) : c
        }, e
    }, a.svg.diagonal.radial = function() {
        var t = a.svg.diagonal(),
            r = function(t) {
                return [t.x, t.y]
            },
            e = t.projection;
        return t.projection = function(t) {
            return arguments.length ? e(function(t) {
                return r = t,
                    function() {
                        var t = r.apply(this, arguments),
                            e = t[0],
                            n = t[1] - halfÏ€;
                        return [e * Math.cos(n), e * Math.sin(n)]
                    }
            }) : r
        }, t
    }, vizuly5.d3v3 = a, Object.keys(vizuly5).forEach(function(t) {
        e[t] = vizuly5[t]
    }), Object.defineProperty(e, "__esModule", {
        value: !0
    })
}, "object" == typeof exports && "undefined" != typeof module ? e(exports) : "function" == typeof define && define.amd ? define(["exports"], e) : e(t.vizuly5 = t.vizuly5 || {}), vizuly5.viz.WeightedTree = function(t) {
    var d5 = vizuly5.d5,
        e = {
            data: null,
            margin: {
                top: "5%",
                bottom: "5%",
                left: "15%",
                right: "7%"
            },
            width: 600,
            height: 600,
            duration: 500,
            key: null,
            tree: d5.tree(),
            children: null,
            value: null,
            valueFormatter: function(t) {
                return t
            },
            label: function(t, e) {
                return t.label
            },
            dataTipLabel: function(t, e) {
                return t.label
            },
            maxNodeRadius: "auto",
            horizontalPadding: "auto",
            verticalPadding: "auto",
            useZoom: !0,
            useZoomToNode: !0,
            dataTipRenderer: function(t, e, n, r, a, i, o) {
            l = '<div class="vz-tip-header2" style="color:gray;text-align:center"> HEADER2 </div>' +
                '<div class="vz-tip-header-rule" style="height:1px;margin:1px auto 3px;margin-top:7px;margin-bottom:7px;background:gray;width:125px;"></div>' +
                '<div class="vz-tip-header1" style="color:gray;text-align:center"> HEADER3 </div>';                    c = s.dataTipLabel(n.data),
                    u = s.valueFormatter(s.value(n.data)),
                    d = "Level: " + n.depth;
                return l = (l = (l = l.replace("HEADER1", c)).replace("HEADER2", u)).replace("HEADER3", d), t.style("height", "80px").html(l), [Number(i) + Number(d5.select(e).attr("width")), o - 100]
            }
        },
        n = {
            "background-opacity": 1,
            "background-color-top": "#FFF",
            "background-color-bottom": "#DDD",
            "label-color": "#333",
            "label-fill-opacity": 1,
            "label-font-family": null,
            "label-font-size": function() {
                return Math.max(10, Math.round(this.size().measuredWidth / 75))
            },
            "label-font-weight": "normal",
            "label-font-weight-over": "bold",
            "label-text-transform": "uppercase",
            "link-stroke": function(t, e) {
                var n = ["#bd0026", "#fecc5c", "#fd8d3c", "#f03b20", "#B02D5D", "#9B2C67", "#982B9A", "#692DA7", "#5725AA", "#4823AF", "#d7b5d8", "#dd1c77", "#5A0C7A", "#5A0C7A"];
                return n[t.target.rootIndex % n.length]
            },
            "link-stroke-opacity": function(t, e) {
                return s.value(t.target.data) && s.value(t.target.data) <= 0 ? .15 : .35
            },
            "link-stroke-opacity-over": .7,
            "node-fill": function(t, e) {
                var n = ["#bd0026", "#fecc5c", "#fd8d3c", "#f03b20", "#B02D5D", "#9B2C67", "#982B9A", "#692DA7", "#5725AA", "#4823AF", "#d7b5d8", "#dd1c77", "#5A0C7A", "#5A0C7A"];
                return n[t.rootIndex % n.length]
            },
            "node-fill-opacity": function(t, e) {
                return s.value(t.data) && s.value(t.data) <= 0 ? .15 : .4
            },
            "node-fill-opacity-over": .9,
            "node-stroke": function(t, e) {
                var n = ["#bd0026", "#fecc5c", "#fd8d3c", "#f03b20", "#B02D5D", "#9B2C67", "#982B9A", "#692DA7", "#5725AA", "#4823AF", "#d7b5d8", "#dd1c77", "#5A0C7A", "#5A0C7A"];
                return n[t.rootIndex % n.length]
            },
            "node-stroke-opacity": .8
        },
        s = {
            initialize: function() {
                s.selection.attr("class", "vz-weighted_tree-viz"), m = s.selection.append("svg").attr("id", s.id).style("overflow", "hidden").attr("class", "vizuly vz-weighted_tree-viz"), vizuly5.util.getDefs(f), x = m.append("rect").attr("class", "vz-background"), l = m.append("g").attr("class", "vz-weighted_tree-viz"), c = l.append("g").attr("class", "vz-weighted_tree-plot"), c.append("rect").attr("class", "vz-plot-background"), _ = c.append("g").attr("class", "vz-weighted_tree-link-plot"), z = c.append("g").attr("class", "vz-weighted_tree-node-plot"), s.useZoom && M.on("zoom", C);
                x.call(M), S.x(function(t) {
                    return t.y
                }).y(function(t) {
                    return t.x
                }), f.on("data_change.internal", N), f.on("height_change.internal", O), f.on("width_change.internal", O), s.dispatch.apply("initialized", this)
            }
        };
    s.properties = e, s.styles = n, s.events = ["mouseover", "mouseout", "click", "zoom", "node_refresh", "data_prepped"];
    var f = vizuly5.core.component(t, s);
    f.version = "2.1.219";
    var r, a, i, p, o, h, g, v, y, m, l, x, c, _, z, u = !0,
        d = !1,
        b = s.tree,
        k = d5.scaleSqrt(),
        w = {},
        A = {},
        S = d5.linkHorizontal(),
        M = d5.zoom(),
        E = function(t) {
            var e;
            return e = 0 != t.depth && t.data ? (k.domain([A[t.depth], w[t.depth]]), k(s.value(t.data))) : k.range()[1] / 2, isNaN(e) ? 0 : e
        };

    function D() {
        if (f.validate(), y = vizuly5.util.size(s.margin, s.width, s.height, s.parent), b.size([y.width, y.height]), 1 == u || d) {
            if (function() {
                    o = 0,
                        function e(n) {
                            if (s.children(n) && !n._children) {
                                for (var t = s.children(n), r = t.length - 1; - 1 < r; r--) s.value(t[r]) < 0 && t.splice(t.indexOf(t[r]), 1);
                                n.children = t, n.children.forEach(function(t) {
                                    t.x0 = n.x, t.y0 = n.y, e(t)
                                })
                            }
                        }(s.data), (r = s.data).x0 = 0, r.y0 = 0, a = [], s.children(s.data).forEach(function(t) {
                            a.push(s.key(t))
                        }), h = d5.hierarchy(r, s.children).eachBefore(function(t) {
                            t.id = (t.parent ? t.parent.id + "_" : "") + vizuly5.util.createCSSKey(s.key(t.data)), 0 < t.depth && (t.rootAncestor = t.parent.rootAncestor ? t.parent.rootAncestor : s.key(t.data), t.rootIndex = a.indexOf(t.rootAncestor))
                        }), (i = b(h).descendants()).forEach(function(t) {
                            0 != t.depth && (w[t.depth] || (w[t.depth] = -1 / 0, A[t.depth] = 1 / 0), o = Math.max(o, t.depth))
                        }), s.dispatch.apply("data_prepped", this)
                }(), 1 == u) {
                h.children.forEach(function t(e) {
                    e.children && (e._children = e.children, e._children.forEach(t), e.children = null)
                })
            }
            d = u = !1
        }
        var t;
        t = "auto" == s.maxNodeRadius ? y.height / s.children(s.data).length : s.maxNodeRadius, "auto" == s.verticalPadding ? b.nodeSize([t, 0]) : b.nodeSize([s.verticalPadding, 0]), k.range([1.5, t / 2]), p = "auto" != s.horizontalPadding ? s.horizontalPadding : y.width / (o + 1);
        for (var e = 1; e < o + 1; e++) {
            var n = i.filter(function(t) {
                return t.depth == e
            });
            w[e] = d5.max(n, function(t) {
                return s.value(t.data)
            }), A[e] = d5.min(n, function(t) {
                return s.value(t.data)
            })
        }
        g = y.left, v = y.top + y.height / 2, s.size = y, s.dispatch.apply("measured", this)
    }

    function N() {
        u = !0
    }

    function R(r, t) {
        t || (t = s.duration);
        var e = b(h).descendants().filter(function(t) {
                return 0 < s.value(t.data) || 0 == t.depth
            }),
            n = h.links().filter(function(t) {
                return 0 < s.value(t.target.data)
            });
        ! function(t, e) {
            var n = -1 / 0,
                r = -1 / 0,
                a = 1 / 0,
                i = 1 / 0;
            if (e.forEach(function(t) {
                    t.r = E(t), n = Math.max(t.x, n), r = Math.max(t.y, r), a = Math.min(t.x, a), i = Math.min(t.y, i)
                }), s.useZoom && M) {
                var o = d5.zoomTransform(x.node());
                i *= o.k, r *= o.k, n *= o.k
            }
            var l = Math.max(y.measuredHeight, n - a + y.top),
                c = Math.max(y.measuredWidth, r + .2 * y.measuredWidth + y.left);
            y.height / 2 + r > l && (l = y.height / 2 + r + b.nodeSize()[0]);
            m.transition().duration(s.duration).style("height", l + "px").style("width", c + "px");
            var u = Math.max(0, -i - y.height / 2) + b.nodeSize()[0];
            e.forEach(function(t) {
                    t.y = t.depth * p + g, t.x = t.x + u + v - b.nodeSize()[0]
                }),
                function(t) {
                    s.selection.transition().duration(s.duration).tween("scrolltween", (n = t, function() {
                        var e = d5.interpolateNumber(r.scrollTop, n);
                        return function(t) {
                            r.scrollTop = e(t)
                        }
                    }));
                    var n;
                    var r = window
                }(t.x)
        }(r, e);
        var a = z.selectAll(".vz-weighted_tree-node").data(e, function(t) {
                return t.id || (t.id = s.key(t.data))
            }),
            i = a.enter().append("g").attr("class", function(t) {
                return "vz-weighted_tree-node vz-id-" + t.id
            }).attr("transform", function(t) {
                return "translate(" + (t.y0 ? t.y0 : r.y0) + "," + (t.x0 ? t.x0 : r.x0) + ")"
            }).on("click", function(t, e) {
                B(t), s.dispatch.apply("click", f, [this, t, e])
            }).on("dblclick", function(t, e) {
                s.dispatch.apply("dblclick", f, [this, e])
            }).on("mouseover", function(t, e) {
                s.dispatch.apply("mouseover", f, [this, t, e])
            }).on("mouseout", function(t, e) {
                s.dispatch.apply("mouseout", f, [this, t, e])
            });
        i.append("circle").attr("class", "vz-weighted_tree-node-circle").attr("r", 1e-6).style("cursor", "pointer"), i.append("text").attr("x", function(t) {
            return t.children || t._children ? -10 : 10
        }).attr("dy", ".35em").attr("text-anchor", function(t) {
            return t.children || t._children ? "end" : "start"
        }).style("pointer-events", "none").text(function(t) {
            return s.label(t.data)
        }), a.exit().transition().duration(t).attr("transform", function(t) {
            return t.x0 = null, t.y0 = null, "translate(" + r.y + "," + r.x + ")"
        }).remove().select("circle").attr("r", 1e-6), a = i.merge(a);
        var o = _.selectAll(".vz-weighted_tree-link").data(n, function(t) {
                return t.target.id
            }),
            l = o.enter().append("path").attr("class", function(t) {
                return "vz-weighted_tree-link vz-id-" + t.target.id
            }).attr("d", function(t) {
                var e = t.target.y0 ? t.target.y0 : r.y0,
                    n = {
                        x: t.target.x0 ? t.target.x0 : r.x0,
                        y: e
                    };
                return S({
                    source: n,
                    target: n
                })
            }).style("stroke-linecap", "round").style("pointer-events", "none");
        o.exit().transition().duration(t).attr("d", function(t) {
            var e = {
                x: r.x0,
                y: r.y0
            };
            return S({
                source: e,
                target: e
            })
        }).remove(), o = l.merge(o), s.dispatch.apply("updated", this);
        var c, u, d = a.transition().duration(t);
        c = function() {
            s.dispatch.apply("node_refresh", f)
        }, u = 0, d.each(function() {
            ++u
        }).on("end", function() {
            --u || c.apply(this, arguments)
        }), d.attr("transform", function(t) {
            return "translate(" + t.y + "," + t.x + ")"
        }), d.select("circle").attr("r", E).style("cursor", function(t) {
            return t.children || t._children ? "pointer" : "auto"
        }), o.transition().duration(t).attr("d", S).style("stroke-width", function(t) {
            return 2 * E(t.target) + "px"
        }), e.forEach(function(t) {
            t.x0 = t.x, t.y0 = t.y
        })
    }

    function C() {
        if (s.useZoom) {
            var t = d5.event.transform;
            c.attr("transform", "translate(" + t.x + "," + t.y + ")scale(" + t.k + ")"), s.dispatch.apply("zoom", f)
        }
    }

    function T(t) {
        if (t && s.useZoom && s.useZoomToNode) {
            var e = d5.zoomTransform(x.node()).k,
                n = d5.zoomIdentity.translate(-t.y * e + y.width / 4, -t.x * e + y.height / 2).scale(e);
            c.transition().duration(1e3).attr("transform", "translate(" + n.x + "," + n.y + ")scale(" + n.k + ")"), M.on("zoom", null), x.call(M.transform, n), M.on("zoom", C), s.dispatch.apply("zoom", f)
        }
    }

    function O() {
        if (s.useZoom) {
            var t = d5.zoomIdentity.translate(0, 0).scale(1);
            M.on("zoom", null), x.call(M.transform, t), x.call(M), M.on("zoom", C), c.attr("transform", "translate(0, 0) scale(1)")
        }
    }

    function B(t) {
        s.children(t.data) && (t.children ? (t._children = t.children, t.children = null, R(t, 0), t.parent && T(t.parent)) : (t.children = t._children, t._children = null, R(t, 0), t.children && T(t)))
    }
    f.scaleToHeight = function() {
        ! function() {
            var t = z.selectAll(".vz-weighted_tree-node");
            minX = minY = 1 / 0, maxX = maxY = -1 / 0, t.each(function(t) {
                minX = Math.min(t.x, minX), maxX = Math.max(t.x, maxX), minY = Math.min(t.y, minY), maxY = Math.max(t.y, maxY)
            });
            var e = (y.height - k.range()[1]) / (maxX - minX),
                n = d5.zoomIdentity.translate(0, -minX * e + k.range()[1]).scale(e);
            x.call(M.transform, n)
        }()
    }, f.update = function(t) {
        return 1 == t && (d = !0), D(), m.attr("width", y.measuredWidth).attr("height", y.measuredHeight), x.attr("width", y.measuredWidth).attr("height", y.measuredHeight), c.style("width", y.width).style("height", y.height), R(r), f
    }, f.toggleNode = function(t) {
        B(t)
    };
    var F = [{
        on: "updated.styles",
        callback: function() {
            if (!s.styles || null == s.styles) return;
            var t = s.selection,
                e = vizuly5.svg.gradient.blend(f, f.getStyle("background-color-bottom"), f.getStyle("background-color-top"));
            t.selectAll(".vz-background").style("fill", function() {
                return "url(#" + e.attr("id") + ")"
            }).style("opacity", f.getStyle("background-opacity")), t.selectAll(".vz-weighted_tree-node circle").style("stroke", function(t, e) {
                return f.getStyle("node-stroke", arguments)
            }).style("stroke-opacity", function(t, e) {
                return f.getStyle("node-stroke-opacity", arguments)
            }).style("fill", function(t, e) {
                return f.getStyle("node-fill", arguments)
            }).style("fill-opacity", function(t, e) {
                return f.getStyle("node-fill-opacity", arguments)
            }), t.selectAll(".vz-weighted_tree-node text").style("font-size", function(t, e) {
                return f.getStyle("label-font-size", arguments) + "px"
            }).style("font-family", function(t, e) {
                return f.getStyle("label-font-family", arguments)
            }).style("font-weight", function(t, e) {
                return f.getStyle("label-font-weight", arguments)
            }).style("text-transform", function(t, e) {
                return f.getStyle("label-text-transform", arguments)
            }).style("fill", function(t, e) {
                return f.getStyle("label-color", arguments)
            }).style("fill-opacity", function(t, e) {
                return f.getStyle("label-fill-opacity", arguments)
            }), t.selectAll(".vz-weighted_tree-link").style("stroke", function(t, e) {
                return f.getStyle("link-stroke", arguments)
            }).style("stroke-opacity", function(t, e) {
                return f.getStyle("link-stroke-opacity", arguments)
            }), s.dispatch.apply("styled", f)
        }
    }, {
        on: "mouseover.styles",
        callback: function(t, e, n) {
            var r = s.selection;
            r.selectAll(".vz-id-" + e.id + " circle").style("fill-opacity", function(t, e) {
                return f.getStyle("node-fill-opacity-over", arguments)
            }), r.selectAll("path.vz-id-" + e.id).style("stroke-opacity", function(t, e) {
                return f.getStyle("link-stroke-opacity-over", arguments)
            }), r.selectAll(".vz-id-" + e.id + " text").transition().style("font-size", function(t, e) {
                return 1.25 * f.getStyle("label-font-size", arguments) + "px"
            }).style("font-weight", function(t, e) {
                return f.getStyle("label-font-weight-over", arguments)
            }), f.showDataTip(t, e, n)
        }
    }, {
        on: "mouseout.styles",
        callback: function(t, e, n) {
            var r = s.selection;
            r.selectAll(".vz-weighted_tree-node circle").style("fill", function(t, e) {
                return f.getStyle("node-fill", arguments)
            }).style("fill-opacity", function(t, e) {
                return f.getStyle("node-fill-opacity", arguments)
            }), r.selectAll(".vz-weighted_tree-node text").transition().style("font-size", function(t, e) {
                return f.getStyle("label-font-size", arguments) + "px"
            }).style("font-weight", function(t, e) {
                return f.getStyle("label-font-weight", arguments)
            }), r.selectAll(".vz-weighted_tree-link").style("stroke-opacity", function(t, e) {
                return f.getStyle("link-stroke-opacity", arguments)
            }), f.removeDataTip()
        }
    }];
    return f.applyCallbacks(F), f
};
